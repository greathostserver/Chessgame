<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø§Ø²ÛŒ Ø´Ø·Ø±Ù†Ø¬ - Chess Game</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');

        /* === 1. Ø²ÛŒØ¨Ø§ÛŒÛŒ Ùˆ Ø¸Ø§Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±Ù¾Ø³Ù†Ø¯ (UI/UX & Customization) === */
        :root {
            --light-square-color: #f0d9b5; /* Ø±Ù†Ú¯ Ø§ÙˆÙ„ÛŒÙ‡ Ø®Ø§Ù†Ù‡ Ø±ÙˆØ´Ù† */
            --dark-square-color: #b58863; /* Ø±Ù†Ú¯ Ø§ÙˆÙ„ÛŒÙ‡ Ø®Ø§Ù†Ù‡ ØªÛŒØ±Ù‡ */
            --highlight-color: #64dd1780; /* Ø±Ù†Ú¯ Ø§Ù†ØªØ®Ø§Ø¨/Ø­Ø±Ú©Øª Ù…Ù…Ú©Ù† */
            --piece-color-light: #ffffff;
            --piece-color-dark: #000000;
        }

        body {
            font-family: 'Vazirmatn', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #2c3e50; /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ØªÛŒØ±Ù‡ Ùˆ Ø´ÛŒÚ© */
            color: #ecf0f1;
            margin: 0;
            padding: 20px;
            direction: rtl; /* ØªÙ†Ø¸ÛŒÙ… Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø±Ø§Ø³Øª Ø¨Ù‡ Ú†Ù¾ Ø¨Ø±Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ/Ø¹Ø±Ø¨ÛŒ */
        }

        .container {
            display: flex;
            flex-direction: row; /* ØªÙ†Ø¸ÛŒÙ… Ú†ÛŒØ¯Ù…Ø§Ù†: ØªØ®ØªÙ‡ Ùˆ Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ Ú©Ù†Ø§Ø± Ù‡Ù… */
            gap: 30px;
            background: #34495e;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        /* === ØªØ®ØªÙ‡ Ø´Ø·Ø±Ù†Ø¬ === */
        #chessboard {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 8px solid #34495e; /* Ø¨ÙˆØ±Ø¯Ø± Ø¶Ø®ÛŒÙ… Ø§Ø·Ø±Ø§Ù ØªØ®ØªÙ‡ */
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            max-width: 480px;
            max-height: 480px;
            transform: rotate(0deg); /* Ø¨Ø±Ø§ÛŒ Ú†Ø±Ø®Ø´ ØªØ®ØªÙ‡ Ø¯Ø± Ø­Ø§Ù„Øª AI */
            transition: transform 0.5s;
        }

        .square {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px; /* Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù…Ù‡Ø±Ù‡ */
            cursor: pointer;
            transition: background-color 0.2s;
            user-select: none;
        }

        .light { background-color: var(--light-square-color); }
        .dark { background-color: var(--dark-square-color); }
        .highlight { background-color: var(--highlight-color) !important; }
        .selected { border: 3px solid #e74c3c; box-sizing: border-box; } /* Ù…Ù‡Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ */

        /* === Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ ÛŒÙˆÙ†ÛŒÚ©Ø¯) === */
        .piece {
            transform: rotate(0deg); /* Ø¨Ø±Ø§ÛŒ Ú†Ø±Ø®Ø´ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ */
            transition: transform 0.5s;
        }

        .white { color: var(--piece-color-light); }
        .black { color: var(--piece-color-dark); }

        /* === Ø¨Ø®Ø´ Ú©Ù†ØªØ±Ù„ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡ === */
        .controls {
            display: flex;
            flex-direction: column;
            width: 250px;
            gap: 15px;
        }

        .controls h3 {
            border-bottom: 2px solid #5d6d7e;
            padding-bottom: 5px;
            margin-top: 0;
        }

        #move-history {
            height: 300px;
            overflow-y: auto;
            background: #2c3e50;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #5d6d7e;
            font-size: 14px;
        }

        #move-history p {
            margin: 3px 0;
            padding: 2px 5px;
            border-radius: 3px;
        }
        #move-history p:nth-child(even) { background-color: #34495e; } /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…ØªÙ†Ø§ÙˆØ¨ */

        /* === Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ùˆ ÙØ±Ù…â€ŒÙ‡Ø§ === */
        button, select {
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button {
            background-color: #3498db;
            color: white;
        }
        button:hover {
            background-color: #2980b9;
        }

        /* === Ù¾Ù†Ø¬Ø±Ù‡ Ù…ÙˆØ¯Ø§Ù„ (Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù† Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡) === */
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #ecf0f1;
            color: #2c3e50;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .modal-content button {
            margin: 10px;
            padding: 10px 20px;
            background-color: #2ecc71;
        }
        .modal-content button:hover {
            background-color: #27ae60;
        }

        .color-picker-group {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }

    </style>
</head>
<body>

    <div id="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-title">Ù„Ø·ÙØ§Ù‹ Ø²Ø¨Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</h2>
            <div id="language-select">
                <button onclick="setLanguage('fa')">ÙØ§Ø±Ø³ÛŒ ğŸ‡®ğŸ‡·</button>
                <button onclick="setLanguage('ar')">Ø§Ù„Ø¹Ø±Ø¨ÛŒØ© ğŸ‡¸ğŸ‡¦</button>
                <button onclick="setLanguage('en')">English ğŸ‡¬ğŸ‡§</button>
            </div>

            <div id="settings-area" style="display: none;">
                <h3 id="ai-level-title">Ø³Ø·Ø­ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</h3>
                <select id="ai-level-select">
                    <option value="1">Ø¢Ø³Ø§Ù† (Easy)</option>
                    <option value="2">Ù…ØªÙˆØ³Ø· (Medium)</option>
                    <option value="3">Ø³Ø®Øª (Hard)</option>
                </select>

                <h3 id="customization-title">Ø³ÙØ§Ø±Ø´ÛŒ Ø³Ø§Ø²ÛŒ Ø±Ù†Ú¯</h3>
                <div class="color-picker-group">
                    <div>
                        <label id="light-square-label" for="light-square-color-input">Ø®Ø§Ù†Ù‡ Ø±ÙˆØ´Ù†</label>
                        <input type="color" id="light-square-color-input" value="#f0d9b5">
                    </div>
                    <div>
                        <label id="dark-square-label" for="dark-square-color-input">Ø®Ø§Ù†Ù‡ ØªÛŒØ±Ù‡</label>
                        <input type="color" id="dark-square-color-input" value="#b58863">
                    </div>
                </div>

                <div class="color-picker-group" style="margin-top: 10px;">
                    <div>
                        <label id="white-piece-label" for="white-piece-color-input">Ù…Ù‡Ø±Ù‡ Ø³ÙÛŒØ¯</label>
                        <input type="color" id="white-piece-color-input" value="#ffffff">
                    </div>
                    <div>
                        <label id="black-piece-label" for="black-piece-color-input">Ù…Ù‡Ø±Ù‡ Ø³ÛŒØ§Ù‡</label>
                        <input type="color" id="black-piece-color-input" value="#000000">
                    </div>
                </div>

                <button id="start-game-button" onclick="startGame()">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
            </div>
        </div>
    </div>


    <div class="container" id="game-container" style="display: none;">
        <div id="chessboard">
            </div>

        <div class="controls">
            <div id="status-message" style="color: #e74c3c; font-weight: bold; min-height: 20px;"></div>

            <h3 id="history-title">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø±Ú©Ø§Øª</h3>
            <div id="move-history">
                </div>
            
            <button id="reset-button" onclick="resetBoard()">Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
        </div>
    </div>

    <audio id="move-sound" src="https://greathostserver.github.io/sounds/move.mp3" preload="auto"></audio>
    <audio id="capture-sound" src="https://greathostserver.github.io/sounds/capture.mp3" preload="auto"></audio>
    <script>
        // === 6. Ù…Ù†Ø·Ù‚ Ø¬Ø§ÙˆØ§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ===

        // === Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ ===
        let boardState = []; // Ø¢Ø±Ø§ÛŒÙ‡ 8x8 Ø¨Ø±Ø§ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ ØªØ®ØªÙ‡
        let selectedSquare = null; // Ø®Ø§Ù†Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ (Ù…Ø«Ù„Ø§Ù‹ {row: 1, col: 0})
        let turn = 'white'; // Ù†ÙˆØ¨Øª Ú©ÛŒØ³Øª: 'white' ÛŒØ§ 'black'
        let moveHistory = []; // Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø­Ø±Ú©Ø§Øª
        let aiLevel = 1; // Ø³Ø·Ø­ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        let lang = 'fa'; // Ø²Ø¨Ø§Ù† ÙØ¹Ù„ÛŒ

        // Ø¬Ø¯ÙˆÙ„ ØªØ±Ø¬Ù…Ù‡
        const translations = {
            fa: {
                title: "Ù„Ø·ÙØ§Ù‹ Ø²Ø¨Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯",
                aiLevelTitle: "Ø³Ø·Ø­ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯",
                customizationTitle: "Ø³ÙØ§Ø±Ø´ÛŒ Ø³Ø§Ø²ÛŒ Ø±Ù†Ú¯",
                lightSquareLabel: "Ø®Ø§Ù†Ù‡ Ø±ÙˆØ´Ù†",
                darkSquareLabel: "Ø®Ø§Ù†Ù‡ ØªÛŒØ±Ù‡",
                whitePieceLabel: "Ù…Ù‡Ø±Ù‡ Ø³ÙÛŒØ¯",
                blackPieceLabel: "Ù…Ù‡Ø±Ù‡ Ø³ÛŒØ§Ù‡",
                startGameButton: "Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ",
                historyTitle: "ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø±Ú©Ø§Øª",
                resetButton: "Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯",
                invalidMove: "Ø­Ø±Ú©Øª ØºÛŒØ±Ù…Ø¬Ø§Ø²! Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.",
                check: "Ú©ÛŒØ´!",
                checkmate: "Ú©ÛŒØ´ Ùˆ Ù…Ø§Øª! Ø¨Ø±Ù†Ø¯Ù‡: ",
                white: "Ø³ÙÛŒØ¯",
                black: "Ø³ÛŒØ§Ù‡",
                easy: "Ø¢Ø³Ø§Ù†",
                medium: "Ù…ØªÙˆØ³Ø·",
                hard: "Ø³Ø®Øª"
            },
            ar: {
                title: "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ØºØ©",
                aiLevelTitle: "Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
                customizationTitle: "ØªØ®ØµÙŠØµ Ø§Ù„Ø£Ù„ÙˆØ§Ù†",
                lightSquareLabel: "Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„ÙØ§ØªØ­",
                darkSquareLabel: "Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†",
                whitePieceLabel: "Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡",
                blackPieceLabel: "Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡",
                startGameButton: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©",
                historyTitle: "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø±ÙƒØ§Øª",
                resetButton: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†",
                invalidMove: "Ø­Ø±ÙƒØ© ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
                check: "ÙƒØ´ Ù…Ù„Ùƒ!",
                checkmate: "ÙƒØ´ Ù…Ø§Øª! Ø§Ù„ÙØ§Ø¦Ø²: ",
                white: "Ø§Ù„Ø£Ø¨ÙŠØ¶",
                black: "Ø§Ù„Ø£Ø³ÙˆØ¯",
                easy: "Ø³Ù‡Ù„",
                medium: "Ù…ØªÙˆØ³Ø·",
                hard: "ØµØ¹Ø¨"
            },
            en: {
                title: "Please Select Language",
                aiLevelTitle: "Select AI Level",
                customizationTitle: "Color Customization",
                lightSquareLabel: "Light Square",
                darkSquareLabel: "Dark Square",
                whitePieceLabel: "White Piece",
                blackPieceLabel: "Black Piece",
                startGameButton: "Start Game",
                historyTitle: "Move History",
                resetButton: "Restart",
                invalidMove: "Illegal move! Try again.",
                check: "Check!",
                checkmate: "Checkmate! Winner: ",
                white: "White",
                black: "Black",
                easy: "Easy",
                medium: "Medium",
                hard: "Hard"
            }
        };

        // Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ ÛŒÙˆÙ†ÛŒÚ©Ø¯ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ (Unicode Pieces)
        const PIECES = {
            'K': 'â™”', 'Q': 'â™•', 'R': 'â™–', 'B': 'â™—', 'N': 'â™˜', 'P': 'â™™', // Ø³ÙÛŒØ¯
            'k': 'â™š', 'q': 'â™›', 'r': 'â™œ', 'b': 'â™', 'n': 'â™', 'p': 'â™Ÿ'  // Ø³ÛŒØ§Ù‡
        };

        // Ú†ÛŒØ¯Ù…Ø§Ù† Ø§ÙˆÙ„ÛŒÙ‡ (FEN string Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
        const INITIAL_BOARD = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];


        // === 7. ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ===

        /**
         * @function setLanguage
         * @description Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø² Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù†
         */
        function setLanguage(selectedLang) {
            lang = selectedLang;
            updateUI_Language();
            // Ù†Ù…Ø§ÛŒØ´ Ù‚Ø³Ù…Øª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù†
            document.getElementById('language-select').style.display = 'none';
            document.getElementById('settings-area').style.display = 'block';
            
            // ØªÙ†Ø¸ÛŒÙ… Ø¬Ù‡Øª ØµÙØ­Ù‡ (RTL Ø¨Ø±Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ/Ø¹Ø±Ø¨ÛŒØŒ LTR Ø¨Ø±Ø§ÛŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)
            document.body.dir = (lang === 'fa' || lang === 'ar') ? 'rtl' : 'ltr';
        }

        /**
         * @function updateUI_Language
         * @description Ø§Ø¹Ù…Ø§Ù„ ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ Ø±ÙˆÛŒ Ø¹Ù†Ø§ØµØ±
         */
        function updateUI_Language() {
            const t = translations[lang];
            document.getElementById('modal-title').textContent = t.title;
            document.getElementById('ai-level-title').textContent = t.aiLevelTitle;
            document.getElementById('customization-title').textContent = t.customizationTitle;
            document.getElementById('light-square-label').textContent = t.lightSquareLabel;
            document.getElementById('dark-square-label').textContent = t.darkSquareLabel;
            document.getElementById('white-piece-label').textContent = t.whitePieceLabel;
            document.getElementById('black-piece-label').textContent = t.blackPieceLabel;
            document.getElementById('start-game-button').textContent = t.startGameButton;
            document.getElementById('history-title').textContent = t.historyTitle;
            document.getElementById('reset-button').textContent = t.resetButton;
            
            // ØªÙ†Ø¸ÛŒÙ… Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ AI
            const select = document.getElementById('ai-level-select');
            select.options[0].textContent = t.easy;
            select.options[1].textContent = t.medium;
            select.options[2].textContent = t.hard;

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø±Ú©Ø§Øª (Ø§Ú¯Ø± Ù„Ø§Ø²Ù… Ø¨Ø§Ø´Ø¯)
            renderHistory();
        }

        /**
         * @function updateColors
         * @description Ù‚Ø§Ø¨Ù„ÛŒØª ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ ØµÙØ­Ù‡ Ùˆ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§
         */
        function updateColors() {
            const root = document.documentElement;
            root.style.setProperty('--light-square-color', document.getElementById('light-square-color-input').value);
            root.style.setProperty('--dark-square-color', document.getElementById('dark-square-color-input').value);
            root.style.setProperty('--piece-color-light', document.getElementById('white-piece-color-input').value);
            root.style.setProperty('--piece-color-dark', document.getElementById('black-piece-color-input').value);

            // Ø§Ø¹Ù…Ø§Ù„ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¨Ù‡ ØªØ®ØªÙ‡
            renderBoard(); 
        }

        /**
         * @function startGame
         * @description Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ù¾Ø³ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
         */
        function startGame() {
            updateColors();
            aiLevel = parseInt(document.getElementById('ai-level-select').value);
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';
            resetBoard(); // ØªÙ†Ø¸ÛŒÙ… ØªØ®ØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹
        }
        
        /**
         * @function resetBoard
         * @description ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬Ø¯Ø¯ ØªØ®ØªÙ‡ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡
         */
        function resetBoard() {
            // Ú©Ù¾ÛŒ Ø¹Ù…ÛŒÙ‚ Ø§Ø² ÙˆØ¶Ø¹ÛŒØª Ø§ÙˆÙ„ÛŒÙ‡
            boardState = INITIAL_BOARD.map(row => [...row]); 
            turn = 'white';
            selectedSquare = null;
            moveHistory = [];
            document.getElementById('status-message').textContent = '';
            document.getElementById('chessboard').style.transform = 'rotate(0deg)'; // Ø±ÛŒØ³Øª Ú†Ø±Ø®Ø´
            renderBoard();
            renderHistory();
        }


        /**
         * @function renderBoard
         * @description Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† ØªØ®ØªÙ‡ Ùˆ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ Ø¯Ø± HTML
         */
        function renderBoard() {
            const boardDiv = document.getElementById('chessboard');
            boardDiv.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ù‚Ø¨Ù„ÛŒ

            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const squareDiv = document.createElement('div');
                    squareDiv.classList.add('square');
                    squareDiv.classList.add((r + c) % 2 === 0 ? 'light' : 'dark');
                    squareDiv.dataset.row = r;
                    squareDiv.dataset.col = c;
                    squareDiv.onclick = () => handleSquareClick(r, c);

                    const pieceCode = boardState[r][c];
                    if (pieceCode) {
                        const pieceSpan = document.createElement('span');
                        pieceSpan.classList.add('piece');
                        pieceSpan.classList.add(pieceCode === pieceCode.toUpperCase() ? 'white' : 'black');
                        pieceSpan.textContent = PIECES[pieceCode];
                        pieceSpan.style.transform = boardDiv.style.transform; // Ú†Ø±Ø®Ø´ Ù…Ù‡Ø±Ù‡ Ø¨Ø§ ØªØ®ØªÙ‡
                        squareDiv.appendChild(pieceSpan);
                    }
                    boardDiv.appendChild(squareDiv);
                }
            }
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ø§ÛŒÙ„Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            document.querySelectorAll('.highlight, .selected').forEach(el => el.classList.remove('highlight', 'selected'));
        }
        

        /**
         * @function renderHistory
         * @description ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø±Ú©Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡
         */
        function renderHistory() {
            const historyDiv = document.getElementById('move-history');
            historyDiv.innerHTML = '';
            
            // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø± Ø¯Ùˆ Ø­Ø±Ú©Øª (Ø³ÙÛŒØ¯ Ùˆ Ø³ÛŒØ§Ù‡) Ø¯Ø± ÛŒÚ© Ø®Ø·
            for (let i = 0; i < moveHistory.length; i += 2) {
                const p = document.createElement('p');
                const moveNumber = Math.floor(i / 2) + 1;
                const whiteMove = moveHistory[i] || '';
                const blackMove = moveHistory[i + 1] || '';

                // ÙØ±Ù…Øª: 1. e4 e5
                p.textContent = `${moveNumber}. ${whiteMove} ${blackMove}`; 
                historyDiv.appendChild(p);
            }
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
            historyDiv.scrollTop = historyDiv.scrollHeight;
        }


        /**
         * @function playSound
         * @description Ù¾Ø®Ø´ ØµØ¯Ø§ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§
         */
        function playSound(isCapture) {
            const soundElement = document.getElementById(isCapture ? 'capture-sound' : 'move-sound');
            // reset and play to allow rapid moves
            soundElement.currentTime = 0;
            soundElement.play().catch(e => console.error("Sound play failed:", e)); 
        }

        // === 8. Ù…Ù†Ø·Ù‚ Ø­Ø±Ú©Øª (Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡) ===

        /**
         * @function getValidMoves
         * @description ÛŒÚ© ØªØ§Ø¨Ø¹ Ø¨Ø³ÛŒØ§Ø± Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø­Ø±Ú©Ø§Øª Ù‚Ø§Ù†ÙˆÙ†ÛŒ
         * **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø¨Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø·Ø±Ù†Ø¬ Ù†ÛŒØ³Øª Ùˆ ØªÙ†Ù‡Ø§
         * Ø¨Ø±Ø®ÛŒ Ø§Ø² Ø­Ø±Ú©Ø§Øª Ù¾Ø§ÛŒÙ‡ Ø±Ø§ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
         * Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø§Ù…Ù„ Ú©ÛŒØ´ØŒ Ù…Ø§ØªØŒ Ù‚Ù„Ø¹Ù‡ Ùˆ... Ø¨Ø³ÛŒØ§Ø± Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø§Ø³Øª.
         */
        function getValidMoves(r, c) {
            const pieceCode = boardState[r][c];
            if (!pieceCode) return [];
            
            const pieceType = pieceCode.toLowerCase();
            const isWhite = pieceCode === pieceCode.toUpperCase();
            const moves = [];

            // Ø§ÛŒÙ† ØªÙ†Ù‡Ø§ ÛŒÚ© Ù…Ø«Ø§Ù„ Ø³Ø§Ø¯Ù‡ Ø§Ø³Øª!
            switch (pieceType) {
                case 'p': // Ù¾ÛŒØ§Ø¯Ù‡ (Pawn)
                    const direction = isWhite ? -1 : 1; // -1 Ø¨Ø±Ø§ÛŒ Ø³ÙÛŒØ¯ (Ø±Ùˆ Ø¨Ù‡ Ø¨Ø§Ù„Ø§), 1 Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ§Ù‡ (Ø±Ùˆ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†)
                    const startRow = isWhite ? 6 : 1;

                    // Ø­Ø±Ú©Øª ÛŒÚ© Ø®Ø§Ù†Ù‡ Ø¨Ù‡ Ø¬Ù„Ùˆ
                    const nextRow = r + direction;
                    if (nextRow >= 0 && nextRow < 8 && !boardState[nextRow][c]) {
                        moves.push({r: nextRow, c: c});
                        // Ø­Ø±Ú©Øª Ø¯Ùˆ Ø®Ø§Ù†Ù‡ Ø§Ø² Ø±Ø¯ÛŒÙ Ø´Ø±ÙˆØ¹
                        if (r === startRow) {
                            const twoStepsRow = r + 2 * direction;
                            if (!boardState[twoStepsRow][c]) {
                                moves.push({r: twoStepsRow, c: c});
                            }
                        }
                    }

                    // Ø­Ù…Ù„Ù‡ (Capture)
                    [-1, 1].forEach(colOffset => {
                        const targetCol = c + colOffset;
                        if (targetCol >= 0 && targetCol < 8) {
                            const targetPiece = boardState[nextRow][targetCol];
                            if (targetPiece) {
                                const targetIsWhite = targetPiece === targetPiece.toUpperCase();
                                if (isWhite !== targetIsWhite) { // Ø§Ú¯Ø± Ù…Ù‡Ø±Ù‡ Ø­Ø±ÛŒÙ Ø¨Ø§Ø´Ø¯
                                    moves.push({r: nextRow, c: targetCol});
                                }
                            }
                        }
                    });
                    break;
                case 'r': // Ø±Ø® (Rook) - ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø«Ø§Ù„
                    // Ø­Ø±Ú©Øªâ€ŒÙ‡Ø§ÛŒ Ø§ÙÙ‚ÛŒ Ùˆ Ø¹Ù…ÙˆØ¯ÛŒ (Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
                    [[0, 1], [0, -1], [1, 0], [-1, 0]].forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            const tr = r + dr * i;
                            const tc = c + dc * i;
                            if (tr < 0 || tr >= 8 || tc < 0 || tc >= 8) break;
                            
                            const targetPiece = boardState[tr][tc];
                            if (targetPiece) {
                                const targetIsWhite = targetPiece === targetPiece.toUpperCase();
                                if (isWhite !== targetIsWhite) {
                                    moves.push({r: tr, c: tc}); // Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù‡Ø±Ù‡ Ø±Ø§ Ø¨Ú¯ÛŒØ±Ø¯
                                }
                                break; // Ø¬Ù„ÙˆÛŒ Ø­Ø±Ú©Øª ØªÙˆØ³Ø· Ù…Ù‡Ø±Ù‡ Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡
                            }
                            moves.push({r: tr, c: tc});
                        }
                    });
                    break;
                // ... (Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ù‚ÛŒÙ‡ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ (Ø´Ø§Ù‡ØŒ ÙˆØ²ÛŒØ±ØŒ ÙÛŒÙ„ØŒ Ø§Ø³Ø¨) Ø¨Ù‡ Ø´Ø¯Øª Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø§Ø³Øª Ùˆ Ø¨Ø§ÛŒØ¯ Ø¯Ø± ÛŒÚ© Ù¾Ø±ÙˆÚ˜Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ Ø´Ø·Ø±Ù†Ø¬ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯.)
            }
            return moves;
        }


        /**
         * @function isValidMove
         * @description Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø¢ÛŒØ§ Ø­Ø±Ú©Øª Ø§Ø² Ù…Ø¨Ø¯Ø£ Ø¨Ù‡ Ù…Ù‚ØµØ¯ Ù…Ø¬Ø§Ø² Ø§Ø³Øª ÛŒØ§ Ø®ÛŒØ±
         */
        function isValidMove(fromR, fromC, toR, toC) {
            const validMoves = getValidMoves(fromR, fromC);
            return validMoves.some(move => move.r === toR && move.c === toC);
        }

        /**
         * @function algebraicNotation
         * @description ØªØ¨Ø¯ÛŒÙ„ Ù…Ø®ØªØµØ§Øª (r, c) Ø¨Ù‡ Ù†Ù…Ø§Ø¯ Ø´Ø·Ø±Ù†Ø¬ÛŒ (Ù…Ø«Ù„Ø§Ù‹ 0, 0 Ø¨Ù‡ A8)
         */
        function algebraicNotation(r, c) {
            const colMap = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
            const rowMap = ['8', '7', '6', '5', '4', '3', '2', '1'];
            return colMap[c] + rowMap[r];
        }


        /**
         * @function handleSquareClick
         * @description Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ Ø®Ø§Ù†Ù‡ Ø´Ø·Ø±Ù†Ø¬
         */
        function handleSquareClick(r, c) {
            const t = translations[lang];
            const pieceCode = boardState[r][c];

            if (selectedSquare) {
                // Ú¯Ø§Ù… 2: Ø®Ø§Ù†Ù‡ Ù…Ù‚ØµØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø§Ø³Øª
                const fromR = selectedSquare.row;
                const fromC = selectedSquare.col;

                if (fromR === r && fromC === c) {
                    // Ú©Ù„ÛŒÚ© Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø±ÙˆÛŒ Ù‡Ù…Ø§Ù† Ø®Ø§Ù†Ù‡: Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨
                    selectedSquare = null;
                    renderBoard();
                    return;
                }

                const pieceToMove = boardState[fromR][fromC];
                const isWhitePiece = pieceToMove === pieceToMove.toUpperCase();

                // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¨Øª
                if ((turn === 'white' && !isWhitePiece) || (turn === 'black' && isWhitePiece)) {
                    // Ø§Ú¯Ø± Ø®Ø§Ù†Ù‡ Ù…Ù‚ØµØ¯ Ù…Ù‡Ø±Ù‡ Ø®ÙˆØ¯ÛŒ Ø¨Ø§Ø´Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ (ØªØºÛŒÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨)
                    if (pieceCode && isWhitePiece === (turn === 'white')) {
                        selectedSquare = {row: r, col: c};
                        renderBoard();
                        highlightValidMoves(r, c);
                        return;
                    }
                    // Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±ØªØŒ Ú©Ø§Ø±ÛŒ Ù†Ú©Ù†ÛŒØ¯
                    return;
                }

                // === Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø­Ø±Ú©Øª (Illegal Move Check) ===
                if (isValidMove(fromR, fromC, r, c)) {
                    const isCapture = !!pieceCode;
                    
                    // Ø§Ù†Ø¬Ø§Ù… Ø­Ø±Ú©Øª
                    boardState[r][c] = pieceToMove;
                    boardState[fromR][fromC] = null;

                    // Ø«Ø¨Øª Ø­Ø±Ú©Øª
                    const moveText = algebraicNotation(fromR, fromC) + (isCapture ? 'x' : '-') + algebraicNotation(r, c);
                    moveHistory.push(moveText);

                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ÙˆØ¨Øª Ùˆ UI
                    turn = turn === 'white' ? 'black' : 'white';
                    selectedSquare = null;
                    document.getElementById('status-message').textContent = '';
                    
                    renderBoard();
                    renderHistory();
                    playSound(isCapture);

                    // Ø§Ú¯Ø± Ù†ÙˆØ¨Øª Ø³ÛŒØ§Ù‡ (AI) Ø§Ø³ØªØŒ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø¨Ù‡ AI Ø¨Ø³Ù¾Ø§Ø±ÛŒØ¯
                    if (turn === 'black') {
                        document.getElementById('chessboard').style.transform = 'rotate(180deg)';
                        setTimeout(makeAIMove, 500); // ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø­Ø³ Ø·Ø¨ÛŒØ¹ÛŒ
                    } else {
                        document.getElementById('chessboard').style.transform = 'rotate(0deg)';
                    }
                } else {
                    // === Ù‡Ø´Ø¯Ø§Ø± Ø­Ø±Ú©Øª ØºÛŒØ±Ù‚Ø§Ù†ÙˆÙ†ÛŒ ===
                    document.getElementById('status-message').textContent = t.invalidMove;
                    selectedSquare = null; // Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨
                    renderBoard();
                }

            } else {
                // Ú¯Ø§Ù… 1: Ø®Ø§Ù†Ù‡ Ù…Ø¨Ø¯Ø£ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø§Ø³Øª (Select Piece)
                if (pieceCode) {
                    const isWhitePiece = pieceCode === pieceCode.toUpperCase();

                    // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¨Øª
                    if ((turn === 'white' && isWhitePiece) || (turn === 'black' && !isWhitePiece)) {
                        selectedSquare = {row: r, col: c};
                        renderBoard();
                        document.querySelector(`[data-row="${r}"][data-col="${c}"]`).classList.add('selected');
                        highlightValidMoves(r, c);
                        document.getElementById('status-message').textContent = '';
                    } else {
                        // Ù‡Ø´Ø¯Ø§Ø±: Ù†ÙˆØ¨Øª Ø­Ø±ÛŒÙ Ø§Ø³Øª
                        document.getElementById('status-message').textContent = `Wait for ${turn}'s turn!`;
                    }
                }
            }
        }


        /**
         * @function highlightValidMoves
         * @description Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø­Ø±Ú©Øª Ø¨Ù‡ Ø¢Ù†Ù‡Ø§ Ù…Ø¬Ø§Ø² Ø§Ø³Øª Ø±Ø§ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
         */
        function highlightValidMoves(r, c) {
            const validMoves = getValidMoves(r, c);
            validMoves.forEach(move => {
                const square = document.querySelector(`[data-row="${move.r}"][data-col="${move.c}"]`);
                if (square) {
                    square.classList.add('highlight');
                }
            });
        }

        // === 9. Ù…Ù†Ø·Ù‚ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (AI) - Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ ===
        
        /**
         * @function getAllPossibleMoves
         * @description Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø­Ø±Ú©Ø§Øª Ù…Ù…Ú©Ù† Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø±Ù†Ú¯
         */
        function getAllPossibleMoves(color) {
            const isWhite = color === 'white';
            const allMoves = [];
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const pieceCode = boardState[r][c];
                    if (pieceCode) {
                        const pieceIsWhite = pieceCode === pieceCode.toUpperCase();
                        if (isWhite === pieceIsWhite) {
                            const validMoves = getValidMoves(r, c);
                            validMoves.forEach(move => {
                                allMoves.push({
                                    from: {r: r, c: c},
                                    to: move
                                });
                            });
                        }
                    }
                }
            }
            return allMoves;
        }

        /**
         * @function getBestMove
         * @description Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø±Ú©Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­
         * **ØªÙˆØ¬Ù‡:** Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ÙÙ‚Ø· Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­ØŒ ØªØµØ§Ø¯ÙÛŒ ÛŒØ§ Ú©Ù…ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯Ø§Ù†Ù‡â€ŒØªØ± Ø¹Ù…Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
         */
        function getBestMove() {
            const allMoves = getAllPossibleMoves('black');
            if (allMoves.length === 0) return null;

            if (aiLevel === 1) {
                // Ø¢Ø³Ø§Ù† (Easy): Ø­Ø±Ú©Øª Ú©Ø§Ù…Ù„Ø§Ù‹ ØªØµØ§Ø¯ÙÛŒ
                const randomIndex = Math.floor(Math.random() * allMoves.length);
                return allMoves[randomIndex];
            } else if (aiLevel === 2) {
                // Ù…ØªÙˆØ³Ø· (Medium): Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§ Ú¯Ø±ÙØªÙ† Ù…Ù‡Ø±Ù‡ (capture)
                const captureMoves = allMoves.filter(move => boardState[move.to.r][move.to.c]);
                if (captureMoves.length > 0) {
                    const randomIndex = Math.floor(Math.random() * captureMoves.length);
                    return captureMoves[randomIndex];
                }
                // Ø§Ú¯Ø± Ú©Ù¾Ú†Ø±ÛŒ Ù†Ø¨ÙˆØ¯ØŒ ØªØµØ§Ø¯ÙÛŒ
                const randomIndex = Math.floor(Math.random() * allMoves.length);
                return allMoves[randomIndex];
            } else if (aiLevel === 3) {
                 // Ø³Ø®Øª (Hard): Ø§ÛŒÙ† Ø³Ø·Ø­ Ø¨Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ÛŒÚ© Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… ÙˆØ§Ù‚Ø¹ÛŒ (Ù…Ø«Ù„ Minimax) Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯. 
                 // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒØŒ Ø±ÙØªØ§Ø± Medium Ø±Ø§ ØªÚ©Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
                const captureMoves = allMoves.filter(move => boardState[move.to.r][move.to.c]);
                if (captureMoves.length > 0) {
                    // Ø¯Ø± Ø§ÛŒÙ† Ø³Ø·Ø­ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø§Ø±Ø²Ø´â€ŒØªØ± (Ù…Ø«Ù„ Ø±Ø®) Ø§ÙˆÙ„ÙˆÛŒØª Ù‚Ø§Ø¦Ù„ Ø´ÙˆÛŒÙ…
                    const valuedMoves = captureMoves.sort((a, b) => {
                        const pieceA = boardState[a.to.r][a.to.c].toLowerCase();
                        const pieceB = boardState[b.to.r][b.to.c].toLowerCase();
                        const valueMap = { 'p': 1, 'n': 3, 'b': 3, 'r': 5, 'q': 9, 'k': 100 };
                        return valueMap[pieceB] - valueMap[pieceA]; // Ú¯Ø±ÙØªÙ† Ù…Ù‡Ø±Ù‡ Ø¨Ø§Ø§Ø±Ø²Ø´â€ŒØªØ± Ø¯Ø± Ø§ÙˆÙ„ÙˆÛŒØª
                    });
                    return valuedMoves[0];
                }
                // Ø§Ú¯Ø± Ú©Ù¾Ú†Ø±ÛŒ Ù†Ø¨ÙˆØ¯ØŒ ØªØµØ§Ø¯ÙÛŒ
                const randomIndex = Math.floor(Math.random() * allMoves.length);
                return allMoves[randomIndex];
            }
        }

        /**
         * @function makeAIMove
         * @description Ø§Ø¬Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
         */
        function makeAIMove() {
            const move = getBestMove();
            if (move) {
                const fromR = move.from.r;
                const fromC = move.from.c;
                const toR = move.to.r;
                const toC = move.to.c;

                const pieceToMove = boardState[fromR][fromC];
                const isCapture = !!boardState[toR][toC];

                // Ø§Ù†Ø¬Ø§Ù… Ø­Ø±Ú©Øª
                boardState[toR][toC] = pieceToMove;
                boardState[fromR][fromC] = null;

                // Ø«Ø¨Øª Ø­Ø±Ú©Øª
                const moveText = algebraicNotation(fromR, fromC) + (isCapture ? 'x' : '-') + algebraicNotation(toR, toC);
                moveHistory.push(moveText);

                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ÙˆØ¨Øª Ùˆ UI
                turn = 'white';
                renderBoard();
                renderHistory();
                playSound(isCapture);
                
                // Ú†Ø±Ø®Ø´ ØªØ®ØªÙ‡ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡
                document.getElementById('chessboard').style.transform = 'rotate(0deg)';

            } else {
                // Ø§Ú¯Ø± Ø­Ø±Ú©ØªÛŒ Ù†Ø¨Ø§Ø´Ø¯ØŒ Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø§Ø³Øª (Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ú©ÛŒØ´ Ùˆ Ù…Ø§Øª)
                document.getElementById('status-message').textContent = translations[lang].checkmate + translations[lang].white;
            }
        }

        // === 10. Ø´Ø±ÙˆØ¹: ØªÙ†Ø¸ÛŒÙ… Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ùˆ Ø±Ù†Ø¯Ø± Ø§ÙˆÙ„ÛŒÙ‡ ===
        document.addEventListener('DOMContentLoaded', () => {
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø´Ù†ÙˆÙ†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ø¯Ø± Ø¨Ø®Ø´ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
            document.getElementById('light-square-color-input').addEventListener('input', updateColors);
            document.getElementById('dark-square-color-input').addEventListener('input', updateColors);
            document.getElementById('white-piece-color-input').addEventListener('input', updateColors);
            document.getElementById('black-piece-color-input').addEventListener('input', updateColors);
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù†
            document.getElementById('modal-overlay').style.display = 'flex';
        });

    </script>
</body>
</html>
