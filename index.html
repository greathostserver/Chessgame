<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chess Game</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0f172a;color:white;display:flex;justify-content:center}
    .app{margin-top:20px;background:#0b1220;padding:20px;border-radius:12px;width:95%;max-width:1000px}
    .header{display:flex;justify-content:space-between;align-items:center}
    .board{display:grid;grid-template-columns:repeat(8,1fr);width:320px;height:320px}
    .cell{display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer}
    .light{background:#f0d9b5}
    .dark{background:#b58863}
    .sidebar{margin-left:20px}
    .main{display:flex;gap:20px;margin-top:20px}
    button{padding:6px 12px;border:none;background:#06b6d4;border-radius:6px;font-weight:700}
  </style>
</head>
<body>

<div class="app" id="root"></div>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/chess.js@1.0.0/chess.min.js"></script>

<script>
const e = React.createElement;

const T = {
  fa:{newgame:"بازی جدید",invalid:"حرکت غیرقانونی",history:"تاریخچه"},
  en:{newgame:"New Game",invalid:"Invalid Move",history:"History"},
  ar:{newgame:"جديد",invalid:"خطأ",history:"السجل"}
}

function App(){
  const [lang,setLang]=React.useState("fa");
  const t=T[lang];
  const [game,setGame]=React.useState(new Chess());
  const [board,setBoard]=React.useState(game.board());
  const [history,setHistory]=React.useState([]);
  const [selected,setSelected]=React.useState(null);

  function reset(){
    const g=new Chess();
    setGame(g);
    setBoard(g.board());
    setHistory([]);
  }

  function clickSquare(r,c){
    const sq="abcdefgh"[c]+(8-r);
    if(selected){
      const m=game.move({from:selected,to:sq,promotion:"q"});
      if(m){setHistory(h=>[...h,m.san]);}
      else alert(t.invalid);
      setSelected(null);
      setBoard(game.board());
    }else{
      const p=game.get(sq);
      if(p && p.color===game.turn()) setSelected(sq);
    }
  }

  return e("div",null,

    e("div",{className:"header"},
      e("select",{onChange:e=>setLang(e.target.value)} ,
        e("option",{value:"fa"},"فارسی"),
        e("option",{value:"en"},"English"),
        e("option",{value:"ar"},"العربية")
      ),
      e("button",{onClick:reset},t.newgame)
    ),

    e("div",{className:"main"},

      e("div",{className:"board"},
        board.map((row,r)=>row.map((cell,c)=>
          e("div",{
            key:r+""+c,
            className:"cell "+(((r+c)%2)?"dark":"light"),
            onClick:()=>clickSquare(r,c)
          },cell?cell.type:"")
        ))
      ),

      e("div",{className:"sidebar"},
        e("h3",null,t.history),
        history.map((h,i)=>e("div",{key:i},h))
      )

    )
  )
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>

</body>
</html>
