<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChessGame (GitHub Pages Ready)</title>
  <style>
    :root{
      --bg:#0f172a; --card:#0b1220; --accent:#06b6d4; --text:#e6eef8; --muted:#9aa8bf;
    }
    *{box-sizing:border-box}
    html,body,#root{height:100%}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Roboto,-apple-system,"Segoe UI",Arial;color:var(--text);background:linear-gradient(180deg,var(--bg),#071028);-webkit-font-smoothing:antialiased}
    .app{max-width:1100px;margin:28px auto;padding:20px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 6px 30px rgba(2,6,23,0.7)}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700}
    .title{font-size:18px;font-weight:700}
    .controls{display:flex;gap:10px;align-items:center}
    select,input[type=range],button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:var(--text)}
    .main{display:grid;grid-template-columns:420px 1fr;gap:18px}
    .board-wrap{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:12px}
    .board{width:392px;height:392px;display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);border-radius:8px;overflow:hidden}
    .square{width:49px;height:49px;display:flex;align-items:center;justify-content:center;font-size:28px;user-select:none}
    .light{background:#f0d9b5}
    .dark{background:#b58863}
    .piece{width:42px;height:42px;display:flex;align-items:center;justify-content:center;border-radius:6px}
    .sidebar{padding:14px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:12px;display:flex;flex-direction:column}
    .history{flex:1;overflow:auto;margin-top:12px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .history-item{padding:6px 8px;border-radius:6px;margin-bottom:6px;background:rgba(0,0,0,0.15);display:flex;justify-content:space-between}
    .lang-select{display:flex;gap:8px}
    .small{font-size:13px;color:var(--muted)}
    .settings{display:flex;flex-direction:column;gap:8px}
    .btn{padding:8px 12px;border-radius:10px;border:none;background:var(--accent);color:#001;cursor:pointer;font-weight:600}
    .row{display:flex;gap:8px;align-items:center}
    .theme-palette{display:flex;gap:6px}
    .swatch{width:28px;height:28px;border-radius:6px;cursor:pointer;border:2px solid rgba(255,255,255,0.06)}
    footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
    @media(max-width:980px){.main{grid-template-columns:1fr;}.board{width:320px;height:320px}.board-wrap{display:flex;justify-content:center}}
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/chess.js@1.0.0-beta.3/chess.js"></script>
  <script>
    const e=React.createElement
    const translations={
      en:{play:'Play',newgame:'New Game',ai:'Play vs AI',level:'AI Level',language:'Language',boardColor:'Board Theme',pieceColor:'Piece Color',moveHistory:'Move History',sound:'Sound',youInvalid:'Invalid move',white:'White',black:'Black',selectSide:'Choose side',start:'Start Game'},
      fa:{play:'بازی',newgame:'شروع جدید',ai:'بازی با هوش مصنوعی',level:'سطح هوش',language:'زبان',boardColor:'تم صفحه',pieceColor:'رنگ مهره',moveHistory:'تاریخچه حرکات',sound:'صدا',youInvalid:'حرکت نامعتبر',white:'سفید',black:'سیاه',selectSide:'طرف را انتخاب کنید',start:'شروع'},
      ar:{play:'اللعب',newgame:'جديد',ai:'العب مع الذكاء',level:'مستوى',language:'اللغة',boardColor:'سمة اللوحة',pieceColor:'لون القطع',moveHistory:'سجل التحركات',sound:'صوت',youInvalid:'حركة غير صالحة',white:'أبيض',black:'أسود',selectSide:'اختر الجنب',start:'ابدأ'}
    }
    function useStateInit(key,init){
      const s=localStorage.getItem(key)
      if(s)return JSON.parse(s)
      return init
    }
    function App(){
      const [lang,setLang]=React.useState(useStateInit('chess_lang','fa'))
      const t=translations[lang]
      const [game,setGame]=React.useState(new Chess())
      const [board,setBoard]=React.useState([])
      const [history,setHistory]=React.useState([])
      const [aiOn,setAiOn]=React.useState(true)
      const [aiLevel,setAiLevel]=React.useState(2)
      const [whitePlays,setWhitePlays]=React.useState('human')
      const [soundOn,setSoundOn]=React.useState(true)
      const [theme,setTheme]=React.useState(useStateInit('chess_theme',{light:'#f0d9b5',dark:'#b58863'}))
      const [pieceColors,setPieceColors]=React.useState(useStateInit('chess_piece_colors',{white:'#ffffff',black:'#111111'}))
      const [selected,setSelected]=React.useState(null)
      const boardRef=React.useRef(null)
      const audioCtx=React.useRef(null)
      React.useEffect(()=>{setBoard(renderBoard(game))},[game,theme,pieceColors])
      React.useEffect(()=>{localStorage.setItem('chess_lang',JSON.stringify(lang))},[lang])
      React.useEffect(()=>{localStorage.setItem('chess_theme',JSON.stringify(theme))},[theme])
      React.useEffect(()=>{localStorage.setItem('chess_piece_colors',JSON.stringify(pieceColors))},[pieceColors])
      function renderBoard(g){
        const fen=g.fen()
        const rows=[]
        for(let r=8;r>=1;r--){
          for(let f=1;f<=8;f++){rows.push({sq: 'abcdefgh'[f-1]+r, color:((r+f)%2===0)?'light':'dark', piece:g.get('abcdefgh'[f-1]+r)})
          }
        }
        return rows
      }
      function playSound(){
        if(!soundOn)return
        try{
          if(!audioCtx.current)audioCtx.current=new (window.AudioContext||window.webkitAudioContext)()
          const ctx=audioCtx.current
          const o=ctx.createOscillator();const g=ctx.createGain();o.type='square';o.frequency.value=440;g.gain.value=0.04;o.connect(g);g.connect(ctx.destination);o.start();g.gain.exponentialRampToValueAtTime(0.00001,ctx.currentTime+0.15);o.stop(ctx.currentTime+0.16)
        }catch(e){}
      }
      function onSquareClick(sq){
        if(game.game_over())return
        const piece=game.get(sq)
        if(selected){
          const move=game.move({from:selected,to:sq,promotion:'q'})
          if(move){
            setHistory(h=>[...h,move.san])
            setGame(new Chess(game.fen()))
            setSelected(null)
            playSound()
            if(aiOn && game.turn()!==(whitePlays==='human'?'w':'b'))setTimeout(()=>makeAiMove(),200)
            return
          }else{
            alert(t.youInvalid)
            setSelected(null)
            return
          }
        }
        if(piece){
          const turnColor=game.turn()==='w'?'w':'b'
          if((piece.color==='w'&&turnColor==='w')||(piece.color==='b'&&turnColor==='b')){
            setSelected(sq)
          }
        }
      }
      function makeAiMove(){
        const depth=aiLevel
        const best=bestMove(new Chess(game.fen()),depth)
        if(best){
          game.move(best)
          setHistory(h=>[...h,game.history({verbose:false}).slice(-1)[0]])
          setGame(new Chess(game.fen()))
          playSound()
        }
      }
      function bestMove(g,depth){
        const color=g.turn()
        const moves=g.moves()
        if(moves.length===0)return null
        let best=null
        let bestScore=color==='w'?-9999:9999
        for(const m of moves){
          g.move(m)
          const score=minimax(g,depth-1,-99999,99999,color)
          g.undo()
          if(color==='w'){
            if(score>bestScore){bestScore=score;best=m}
          }else{
            if(score<bestScore){bestScore=score;best=m}
          }
        }
        return best
      }
      function minimax(g,depth,alpha,beta,origColor){
        if(depth===0||g.game_over())return evaluate(g,origColor)
        const moves=g.moves()
        if(g.turn()==='w'){
          let max=-99999
          for(const m of moves){g.move(m);const v=minimax(g,depth-1,alpha,beta,origColor);g.undo();if(v>max)max=v;if(v>alpha)alpha=v;if(beta<=alpha)break}
          return max
        }else{
          let min=99999
          for(const m of moves){g.move(m);const v=minimax(g,depth-1,alpha,beta,origColor);g.undo();if(v<min)min=v;if(v<beta)beta=v;if(beta<=alpha)break}
          return min
        }
      }
      function evaluate(g,origColor){
        const pieceValue={p:100,n:320,b:330,r:500,q:900,k:20000}
        const fen=g.fen().split(' ')[0]
        let score=0
        for(const ch of fen){
          if(ch==='/')continue
          if(ch>='1'&&ch<='8')continue
          const isUpper=ch===ch.toUpperCase()
          const v=pieceValue[ch.toLowerCase()]||0
          score += isUpper? v: -v
        }
        return origColor==='w'?score:-score
      }
      function reset(){
        const ng=new Chess()
        setGame(ng)
        setHistory([])
        setSelected(null)
      }
      function exportHtml(){
        const content = document.documentElement.outerHTML
        const blob=new Blob([content],{type:'text/html'})
        const url=URL.createObjectURL(blob)
        const a=document.createElement('a');a.href=url;a.download='index.html';a.click();URL.revokeObjectURL(url)
      }
      return e('div',{className:'app'},
        e('div',{className:'header'},
          e('div',{className:'brand'},e('div',{className:'logo'},'CG'),e('div',null,e('div',{className:'title'},'ChessGame'),e('div',{className:'small'},'GitHub Pages Ready'))),
          e('div',{className:'controls'},
            e('div',{className:'lang-select'},
              e('select',{value:lang,onChange:ev=>setLang(ev.target.value)},
                e('option',{value:'fa'},'فارسی'),e('option',{value:'ar'},'العربية'),e('option',{value:'en'},'English')
              )
            ),
            e('button',{className:'btn',onClick:reset},t.newgame)
          )
        ),
        e('div',{className:'main'},
          e('div',{className:'board-wrap'},
            e('div',{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:10}},
              e('div',null,e('strong',null,t.selectSide+': '),whitePlays==='human'?t.white:t.black),
              e('div',null,e('label',{className:'small'},t.sound+': '),e('input',{type:'checkbox',checked:soundOn,onChange:()=>setSoundOn(s=>!s)}))
            ),
            e('div',{className:'board',ref:boardRef},board.map((sq,i)=>{
              const dark=(i%2===0)===false
              const cls='square '+(sq.color==='light'?'light':'dark')
              const piece=sq.piece
              const displayPiece=piece?pieceSymbol(piece.type,piece.color,pieceColors):null
              return e('div',{key:sq.sq,className:cls,onClick:()=>onSquareClick(sq.sq),style:{background:sq.color==='light'?theme.light:theme.dark}},displayPiece)
            }))
          ),
          e('div',{className:'sidebar'},
            e('div',null,
              e('div',{className:'settings'},
                e('div',{className:'row'},e('label',null,t.ai+': '),e('input',{type:'checkbox',checked:aiOn,onChange:()=>setAiOn(s=>!s)})),
                e('div',{className:'row'},e('label',null,t.level+': '),e('select',{value:aiLevel,onChange:ev=>setAiLevel(parseInt(ev.target.value))},e('option',{value:1},'1'),e('option',{value:2},'2'),e('option',{value:3},'3'))),
                e('div',{className:'row'},e('label',null,t.pieceColor+': '),e('input',{type:'color',value:pieceColors.white,onChange:ev=>setPieceColors(pc=>({...pc,white:ev.target.value}))}),e('input',{type:'color',value:pieceColors.black,onChange:ev=>setPieceColors(pc=>({...pc,black:ev.target.value}))})),
                e('div',{className:'row'},e('label',null,t.boardColor+': '),e('input',{type:'color',value:theme.light,onChange:ev=>setTheme(th=>({...th,light:ev.target.value}))}),e('input',{type:'color',value:theme.dark,onChange:ev=>setTheme(th=>({...th,dark:ev.target.value}))}))
              )
            ),
            e('div',{className:'history'},
              e('div',{style:{fontWeight:700,marginBottom:8}},t.moveHistory),
              history.length===0?e('div',null,e('span',{className:'small'},'—')):history.map((h,idx)=>e('div',{className:'history-item',key:idx},e('div',null,idx+1+'. '+String(h)),e('div',null)))
            ),
            e('div',{style:{marginTop:10,display:'flex',gap:8}},e('button',{className:'btn',onClick:exportHtml},'Download'))
          )
        ),
        e('footer',null,'Deploy this file to greathostserver.github.io/chessgame by placing it as index.html')
      )
    }
    function pieceSymbol(type,color,pc){
      const map={p:'♟',r:'♜',n:'♞',b:'♝',q:'♛',k:'♚'}
      const sym=map[type]||''
      const style={width:38,height:38,display:'flex',alignItems:'center',justifyContent:'center',borderRadius:6,background:color==='w'?pc.white:pc.black,color: color==='w'?'#000':'#fff',fontSize:24}
      return React.createElement('div',{className:'piece',style:style},sym)
    }
    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App))
  </script>
</body>
</html>
